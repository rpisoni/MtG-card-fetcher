<link rel="import" href="@polymer/polymer/polymer.html" />

<dom-module id="mtg-card-fetcher">
    <script src="page/page.js"></script>
    <script>
        (function ()    {
            //page('/', changeView("search"));
            page('/:view', function (context, next)    {
                context.handled = true;
                changeView(context.params.view);
                next();
            });
            function changeView(viewName)   {
                console.log(viewName);
                document.getElementsByTagName('mtg-card-fetcher')[0].setAttribute('view', viewName);
            }
            page.start();
        })();
    </script>
    <template>
        <style>
            a {
                color: rgb(220,220,220);
            }
            a:visited {
                color: rgb(220,220,220);
            }
            table {
                width: 100%;
            }
            #search-table td:nth-child(1) {
                width: 10%;
            }
            #search-table td:nth-child(2) {
                width: 90%;
            }
            #advanced-table td:nth-child(1) {
                width: 10%;
            }
            #advanced-table td:nth-child(2) {
                width: 90%;
            }
            #deck-container {
                width: 70%;
                float: left;
            }
            #deck-stats {
                width: 30%;
                float: right;
                vertical-align: top;
            }
            div.deck-card {
                margin: 15px;
                float: left;
            }
            div.menu-container a {
                padding: 20px;
            }
            div.card-description-container {
                margin: 10px;
                padding: 5px;
                background-color: rgba(89, 63, 7, 0.5);
            }
            div.card-description-container-gold {
                margin: 10px;
                padding: 5px;
                background-color: rgba(191, 163, 22, 0.68);
            }
            div.card-description-container-white {
                margin: 10px;
                padding: 5px;
                background-color: rgb(100, 100, 100);
            }
            div.card-description-container-blue {
                margin: 10px;
                padding: 5px;
                background-color: rgba(71, 117, 163, 0.68);
            }
            div.card-description-container-black {
                margin: 10px;
                padding: 5px;
                background-color: rgba(10, 10, 10, 0.75);
            }
            div.card-description-container-red {
                margin: 10px;
                padding: 5px;
                background-color: rgba(163, 71, 71, 0.68);
            }
            div.card-description-container-green {
                margin: 10px;
                padding: 5px;
                background-color: rgba(117, 163, 71, 0.68);
            }
            div.card-text-container {
                margin: 10px;
                padding: 5px;
                background-color: rgb(125, 125, 125);
            }
            div.card-data-container {
                font-size: 12px;
            }
            span.card-text {
                font-weight: bold;
            }
            div.card-flavor-container {
                margin: 10px;
                padding: 5px;
                background-color: rgb(125, 125, 125);
            }
            span.card-flavor {
                font-style: italic;
            }
            .card-table td:nth-child(1) {
                width: 15%;
                vertical-align: top;
            }
            .card-table td:nth-child(2) {
                width: 60%;
            }
            .card-table td:nth-child(3) {
                width: 25%;
                vertical-align: top;
                
            }
            button.add-to-deck {
                margin: 10px;
                padding: 5px;
            }
        </style>
        <div class="component-container">
            <div class="menu-container">
                <a href="http://localhost:8080/">
                    <span>MTG Card Fetcher</span>
                </a>
                <a href="{{baseUrl}}search">
                    <span>Fetch</span>
                </a>
                <a href="{{baseUrl}}deck">
                    <span>Build</span>
                </a>
                <a href="{{baseUrl}}draft">
                    <span>Draft</span>
                </a>
            </div>
            <hr />
            <div class="content">
                <!-- 
                    -------------------
                        SEARCH VIEW
                    ------------------- 
                                       --->
                <template is="dom-if" if="[[_viewIsSearch(view)]]">
                    <div class="search-div">
                        <h1>Fetch</h1>
                        <hr />
                        <form id="search-form" on-submit="_searchForCards">
                            <table id = "search-table">
                                <tr>
                                    <td>
                                        <label for="search-field">Card Name: </label>
                                    </td>
                                    <td>
                                        <input type="text" id="search-field" placeholder="Enter a card name here!">
                                        <button id="fetch" on-tap="_searchForCards">Fetch</button>
                                    </td>
                                </tr>
                            </table>
                            <div id="advanced-div" style="display:none;">
                                <table id="advanced-table">
                                    <tr>
                                        <td>
                                            <label for="rules-text">Rules Text: </label>
                                        </td>
                                        <td>
                                            <input type="text" id="rules-text">    
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><label for="super-type">Super-Type: </label></td>
                                        <td><input type="text" id="super-type"></td>
                                    </tr>
                                    <tr>
                                        <td><label for="card-type">Type: </label></td>
                                        <td><input type="text" id="card-type"></td>
                                    </tr>
                                    <tr>
                                        <td><label for="sub-type">Sub-Type: </label></td>
                                        <td><input type="text" id="sub-type"></td>
                                    </tr>
                                    <tr>
                                        <td>Colors: </td>
                                        <td>
                                            <label><input type="checkbox" id="color-white" value="white"> White</label>
                                            <label><input type="checkbox" id="color-blue" value="blue"> Blue</label>
                                            <label><input type="checkbox" id="color-black" value="black"> Black</label>
                                            <label><input type="checkbox" id="color-red" value="red"> Red</label>
                                            <label><input type="checkbox" id="color-green" value="green"> Green</label>
                                            <br>
                                            (<label><input type="checkbox" id="color-multi" value="true"> Multi-Color)</label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Rarity:</td>
                                        <td>
                                            <label><input type="checkbox" id="rarity-mythic" value="mythic"> Mythic</label>
                                            <label><input type="checkbox" id="rarity-rare" value="rare"> Rare</label>
                                            <label><input type="checkbox" id="rarity-uncommon" value="uncommon"> Uncommon</label>
                                            <label><input type="checkbox" id="rarity-common" value="Common"> Common</label>
                                            <label><input type="checkbox" id="rarity-basic" value="basic"> Basic Land</label>
                                            <label><input type="checkbox" id="rarity-special" value="special"> Special</label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><label for="set">Set:</label></td>
                                        <td>
                                            <input type="text" id="set" placeholder="Shorthand Identifier">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><label for="format-select">Format: </label></td>
                                        <td>
                                            <select id="format-select">
                                                <option value="">All Formats</option>
                                                <option value="standard">Standard</option>
                                                <option value="modern">Modern</option>
                                                <option value="legacy">Legacy</option>
                                                <option value="vintage">Vintage</option>
                                                <option value="commander">Commander</option>
                                            </select>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <table>
                            <button id="toggle-form" on-tap="_toggleForm">Toggle Advanced Search</button>
                        </form>
                        <hr />
                    </div>
                    <template is="dom-if" if="[[loading_]]">
                        <p>LOADING...</p>
                    </template>
                    <template is="dom-if" if="[[ready_]]">
                        <template is="dom-repeat" items="[[cards]]">
                            <table class="card-table">
                                <tr>
                                    <td>
                                        <img src="{{getCardImage(item.editions)}}" alt="[[item.name]]" />
                                        <p>Illus. [[getCardArtist(item.editions)]]</p>
                                    </td>
                                    <td>
                                        <div class$="[[getCardColor(item.colors)]]">
                                            <h2>[[item.name]]</h2>
                                            <p>
                                                <template is="dom-repeat" items="[[item.supertypes]]">
                                                    [[item]]
                                                </template>
                                                <template is="dom-repeat" items="[[item.types]]">
                                                    [[item]]
                                                </template>
                                                <template is="dom-if" if="[[item.subtypes]]">
                                                    - 
                                                    <template is="dom-repeat" items="[[item.subtypes]]">
                                                        [[item]]
                                                    </template>
                                                </template>
                                            </p>
                                            <div class="card-text-container">
                                                <span class="card-text">[[item.text]]</span>
                                            </div>
                                            <template is="dom-if" if="[[hasCardFlavor(item.editions)]]">
                                                <div class="card-flavor-container">
                                                    <span class="card-flavor">[[getCardFlavor(item.editions)]]</span>
                                                </div>
                                            </template>
                                            <button class="add-to-deck" on-tap="_addCardToDeck">Add To Deck</button>
                                        </div>
                                        
                                    </td>
                                    <td>
                                        <div class="card-data-container">
                                            <ul>
                                                <template is="dom-if" if="[[item.loyalty]]">
                                                    <li>
                                                        <em>Loyalty:</em> [[item.loyalty]]
                                                    </li>
                                                </template>
                                                <template is="dom-if" if="[[item.power]]">
                                                    <li>
                                                        <em>P/T:</em> [[item.power]]/[[item.toughness]]
                                                    </li>
                                                </template>
                                                <li>
                                                    <template is="dom-if" if="[[item.cost]]">
                                                        Cost: [[item.cost]]
                                                    </template>
                                                    <template is="dom-if" if="[[!item.cost]]">
                                                        Cost: 0
                                                    </template>
                                                </li>
                                                <li>
                                                    <em>CMC:</em> [[item.cmc]]
                                                </li>
                                                <br />
                                                <li>
                                                    Editions:
                                                    <ul>
                                                        <template is="dom-repeat" items="[[item.editions]]">
                                                            <li>
                                                                [[item.set]] - [[item.set_id]] ([[item.rarity]])
                                                            </li>
                                                        </template>
                                                    </ul>
                                                </li>
                                                <br />
                                                <li>
                                                    Legal Formats:
                                                    <ul>
                                                        <template is="dom-if" if="[[item.formats.standard]]">
                                                            <li>
                                                                standard - [[item.formats.standard]]
                                                            </li>
                                                        </template>
                                                        <template is="dom-if" if="[[item.formats.modern]]">
                                                            <li>
                                                                modern - [[item.formats.modern]]
                                                            </li>
                                                        </template>
                                                        <template is="dom-if" if="[[item.formats.legacy]]">
                                                            <li>
                                                                legacy - [[item.formats.legacy]]
                                                            </li>
                                                        </template>
                                                        <template is="dom-if" if="[[item.formats.vintage]]">
                                                            <li>
                                                                vintage - [[item.formats.vintage]]
                                                            </li>
                                                        </template>
                                                        <template is="dom-if" if="[[item.formats.commander]]">
                                                            <li>
                                                                commander - [[item.formats.commander]]
                                                            </li>
                                                        </template>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <hr />
                            </table>
                        </template>
                    </template>
                    <template is="dom-if" if="[[error_]]">
                        <h1>AN ERROR HAS OCCURED</h1>
                    </template>
                </template>
                <!-- 
                    -------------------------
                        DECK BUILDER VIEW 
                    -------------------------
                                             --->
                <template is="dom-if" if="{{_viewIsDeck(view)}}">
                    <h1>Build</h1>
                    <hr />
                    <div id="deck-container">
                    <template id="deck-template" is="dom-repeat" items="[[deck]]" filter="filterDeck" observe="type deck.amount">
                        <div class="deck-card">
                                <img src="[[getCardImage(item.card.editions)]]" alt="[[item.card.name]]" />
                                <br />
                                <button class="remove-card" value="[[item.card.name]]" on-tap="_removeCard">Remove</button>
                                <span id="card-amount">{{item.amount}}</span>
                                <button class="add-card" value="[[item.card.name]]" on-tap="_addCard">Add</button>
                        </div>
                    </template>
                    </div>
                    <div id="deck-stats">
                        <ul>
                            <li>Cards in Deck: [[deck.length]]</li>
                            <br />
                            <li>Colors of Cards: 
                                <ul>
                                    <template is="dom-repeat" items="[[getDeckColors()]]" filter="filterColor">
                                        <li>[[item.color]]: [[item.amount]]</li>
                                    </template>
                                </ul>
                            </li>
                            <br />
                            <li>Card Types: 
                                <ul>
                                    <template is="dom-repeat" items="[[getDeckTypes()]]" filter="filterType">
                                        <li>[[item.type]]: [[item.amount]]</li>
                                    </template>
                                </ul>
                            </li>
                            <br />
                            <li>
                                Average Converted Mana Cost: [[getDeckAverageCMC()]]
                            </li>
                            <br />
                            <li>Converted Mana Cost: 
                                <ul>
                                    <template is="dom-repeat" items="[[getDeckCMC()]]" filter="filterCMC">
                                        <li>[[index]]: [[item]]</li>
                                    </template>
                                </ul>
                            </li>
                       
                        </ul>
                        
                        
                    </div>
                </template>
                <!-- 
                    ------------------
                        DRAFT VIEW 
                    ------------------
                                      --->
                <template is="dom-if" if="{{_viewIsDraft(view)}}">
                    <h1>Draft</h1>
                    <hr />
                    <form id="draft-form" on-submit="_getBooster">
                        <select id="draft-select">
                            <option value="SOI">Shadows over Innistrad</option>
                            <option value="OGW">Oath of the Gatewatch</option>
                            <option value="BFZ">Battle for Zendikar</option>
                            <option value="ORI">Magic Origins</option>
                            <option value="DTK">Dragons of Tarkir</option>
                            <option value="FRF">Fate Reforged</option>
                            <option value="KTK">Khans of Tarkir</option>
                        </select>
                        <button id="booster" on-tap="_getBooster">Open Booster</button>
                    </form>
                    <hr />
                    <h2>Booster Contents</h2>
                    <template is="dom-if" if="[[loading_]]">
                        LOADING BOOSTER...
                    </template>
                    <template is="dom-if" if="[[ready_]]">
                        <template is="dom-repeat" items="[[booster.cards]]">
                            <img src="[[item.imageUrl]]" alt="[[item.name]]" on-tap="_pickCard"/>
                            
                        </template>
                    </template>
                    <hr />
                    <h2>Selected Cards</h2>
                </template>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: "mtg-card-fetcher",
           
            properties: {
                params: {
                    type: Array,
                    value: ["search-field","rules-text","super-type","card-type","sub-type",
                            "color-white","color-blue","color-black","color-red","color-green",
                            "color-multi","rarity-mythic","rarity-rare","rarity-uncommon",
                            "rarity-common","rarity-basic","rarity-special","set","format-select"]
                },
                
                filters: {
                    type: Array,
                    value: ["name=","oracle=","supertype=","type=","subtype=","color=","color=",
                            "color=","color=","color=","multicolor=","rarity=","rarity=","rarity=",
                            "rarity=","rarity=","rarity=","set=","format="]
                },
                
                cards:  {
                    type: Object
                },
                
                booster:    {
                    type: Object
                },
                
                deck:   {
                    type: Array,
                    value: []
                },
                
                view:   {
                    type: String,
                    default: "search"  
                },
                
                loading_:   {
                    type: Boolean,
                    value: false
                },
                
                ready_: {
                    type: Boolean,
                    value: false
                },
                
                error_: {
                    type: Boolean,
                    value: false
                }
            }, 
           
            attached: function() {
                console.log("attached");
            },
            
            _searchForCards: function(e) {
                e.preventDefault();
                this.ready_ = false;
                this.loading_ = true;
                this.error_ = false;
                var search = "";
                for(var i = 0; i < this.params.length; i++)
                {
                    if(this.$$('#' + this.params[i]).type !== "checkbox" && this.$$('#' + this.params[i]).value !== "")
                    {
                        if(i > 0 && search !== "")
                        {
                            search = search + "&";
                        }
                        search = search + this.filters[i];
                        search = search + this.$$('#' + this.params[i]).value;
                    }
                    else if(this.$$('#' + this.params[i]).type === "checkbox" && this.$$('#' + this.params[i]).checked)
                    {
                        if(i > 0 && search !== "")
                        {
                            search = search + "&";
                        }
                        
                        search = search + this.filters[i];
                        search = search + this.$$('#' + this.params[i]).value;
                    }
                    
                }
                this.loadCards_(search);
            },
            
            _getBooster: function (e)    {
                e.preventDefault();
                this.ready_ = false;
                this.loading_ = true;
                var set = this.$$('#draft-select').value;
                this.loadBooster(set);
            },
            
            _toggleForm: function(e)    {
                e.preventDefault();
                if(this.$$('#advanced-div').style.cssText  === "display: none;")
                {
                    this.$$('#advanced-div').style.cssText = "display: block";
                }
                else if(this.$$('#advanced-div').style.cssText  === "display: block;")
                {
                    this.$$('#advanced-div').style.cssText = "display: none";
                }
            },
            
            _addCard: function(e)   {
                e.preventDefault();
                for(var i = 0; i < this.deck.length; i++)
                {
                    if(e.model.__data__.item.card.name === this.deck[i].card.name)
                    {
                        this.deck[i].amount++;
                        console.log(this.deck[i].card.name + " , " + this.deck[i].amount);
                        
                    }
                }     
            },
            
            _removeCard: function(e)    {
                e.preventDefault();
                for(var i = 0; i < this.deck.length; i++)
                {
                    if(e.model.__data__.item.card.name === this.deck[i].card.name)
                    {
                        this.deck[i].amount--;
                        console.log(this.deck[i].card.name + " , " + this.deck[i].amount);
                        if(this.deck[i].amount === 0)
                        {
                            this.deck.splice(i,1);
                        }
                        console.log(this.deck);
                        
                    }
                }     
            },
            
            filterDeck: function(item) {
                return true;
            },
            
            filterColor: function(item) {
                if(item.amount > 0)
                {
                    return true;
                }
                else
                {
                    return false;
                }  
            },
            
            filterType: function(item) {
                if(item.amount > 0)
                {
                    return true;
                }
                else
                {
                    return false;
                }
            },
            
            filterCMC: function(item) {
                if(item > 0)
                {
                    return true;
                }  
                else
                {
                    return false;
                }
            },
            
            _pickCard: function(e)    {
                console.log(e);
                console.log("a card was picked");
                console.log(e.model._nodes[0].alt);
            },
            
            _addCardToDeck: function(e) {
                //take card from clicked event and add it to deck
                e.preventDefault();
                var id = 0;
                
                var inDeck = false;
                for(var i = 0; i < this.deck.length; i++)
                {
                    if(this.deck[i].card.name == e.model.__data__.item.name)
                    {
                        inDeck = true;
                        break;
                    }
                }
                if(!inDeck) 
                {
                    var card = {
                        card: e.model.__data__.item,
                        amount: 1
                    };
                
                    this.deck.push(card);
                }
                console.log(this.deck);
            },
           
            loadCards_: function (search)     {
                var self = this;
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "https://api.deckbrew.com/mtg/cards?" + search, true);
               
                xhr.onload = function(evt)   {
                    if(xhr.status === 200)   {
                        self.cards = JSON.parse(xhr.responseText);
                        self.loading_ = false;
                        self.ready_ = true;
                    } else  {
                        self.error_ = true;
                        self.loading_ = false;
                        self.ready_ = false;   
                    }
                };
                xhr.send();
            },
            
            loadBooster: function(set)     {
                var self = this;
                var xhr = new XMLHttpRequest();
                
                xhr.open("GET", "https://api.magicthegathering.io/v1/sets/" + set + "/booster", true);
                
                xhr.onload = function(evt)   {
                    if(xhr.status === 200)   {
                        self.booster = JSON.parse(xhr.responseText);
                        console.log(self.booster);
                        self.loading_ = false;
                        self.ready_ = true;
                    } else  {
                        self.error_ = true;
                        self.loading_ = false;
                        self.ready_ = false;   
                    }
                };
                
                xhr.send();
            },
                           
            _viewIsSearch: function (v)  {
                return v === 'search';
            },
            
            _viewIsDeck: function (v)  {
                return v === 'deck';
            },
            
            _viewIsDraft: function (v)  {
                return v === 'draft';
            },
            
            getCardImage: function (editions) {
                for(var i = 0; i < editions.length; i++)    
                {
                    if(editions[i].image_url && editions[i].image_url !== "https://image.deckbrew.com/mtg/multiverseid/0.jpg")
                    {
                        return editions[i].image_url;
                    }
                }
            },
            
            getCardArtist: function (editions) {
                for(var i = 0; i < editions.length; i++)    
                {
                    if(editions[i].image_url && editions[i].image_url !== "https://image.deckbrew.com/mtg/multiverseid/0.jpg")
                    {
                        return editions[i].artist;
                    }
                }
            },
            
            getCardFlavor: function (editions) {
                for(var i = 0; i < editions.length; i++)    
                {
                    if(editions[i].image_url !== "https://image.deckbrew.com/mtg/multiverseid/0.jpg")
                    {
                        return editions[i].flavor;
                    }
                }
            },
            
            hasCardFlavor: function (editions) {
                for(var i = 0; i < editions.length; i++)    
                {
                    if(editions[i].image_url !== "https://image.deckbrew.com/mtg/multiverseid/0.jpg" && editions[i].flavor)
                    {
                        return true;
                    }
                }
                
                return false;
            },
            
            getCardColor: function (colors) {
                
                if(colors == undefined)
                {
                    return "card-description-container";
                }
                else if(colors.length > 1)
                {
                    return "card-description-container-gold";
                }
                else if(colors[0] === "white")
                {
                    return "card-description-container-white";
                }
                else if(colors[0] === "blue")
                {
                    return "card-description-container-blue";
                }
                else if(colors[0] === "black")
                {
                    return "card-description-container-black";
                }
                else if(colors[0] === "red")
                {
                    return "card-description-container-red";
                }
                else if(colors[0] === "green")
                {
                    return "card-description-container-green";
                }
            },
            
            getDeckColors: function () {
                //return an array with the number of cards of each color in the deck
                var colorArray = [
                    {color:"white",amount:0},
                    {color:"blue",amount:0},
                    {color:"black",amount:0},
                    {color:"red",amount:0},
                    {color:"green",amount:0},
                    {color:"colorless",amount:0}                  
                ];
                
                for(var i = 0; i < this.deck.length; i++)
                {
                    if(this.deck[i].card.colors === undefined)
                    {
                        colorArray[5].amount++;
                    }
                    else
                    {
                        for(var j = 0; j < this.deck[i].card.colors.length; j++)
                        {
                            if(this.deck[i].card.colors[j] === "white")
                            {
                                colorArray[0].amount++;
                            }
                            else if(this.deck[i].card.colors[j] === "blue")
                            {
                                colorArray[1].amount++;
                            }
                            else if(this.deck[i].card.colors[j] === "black")
                            {
                                colorArray[2].amount++;
                            }
                            else if(this.deck[i].card.colors[j] === "red")
                            {
                                colorArray[3].amount++;
                            }
                            else if(this.deck[i].card.colors[j] === "green")
                            {
                                colorArray[4].amount++;
                            }
                        }
                    }
                }
                
                return colorArray;
            },
            
            getDeckTypes: function () {
                //return an array of the number of cards of each type in the deck
                var typeArray = [
                    {type:"artifact",amount:0},
                    {type:"creature",amount:0},
                    {type:"enchantment",amount:0},
                    {type:"instant",amount:0},
                    {type:"land",amount:0},
                    {type:"phenomenon",amount:0},
                    {type:"plane",amount:0},
                    {type:"planeswalker",amount:0},
                    {type:"scheme",amount:0},
                    {type:"sorcery",amount:0},
                    {type:"tribal",amount:0},
                    {type:"vanguard",amount:0}    
                ];
                
                for(var i = 0; i < this.deck.length; i++)
                {    
                    for(var j = 0; j < this.deck[i].card.types.length; j++)
                    {
                        if(this.deck[i].card.types[j] === "artifact")
                        {
                            typeArray[0].amount++;
                        }
                        else if(this.deck[i].card.types[j] === "creature")
                        {
                            typeArray[1].amount++;
                        }
                        else if(this.deck[i].card.types[j] === "enchantment")
                        {
                            typeArray[2].amount++;
                        }
                        else if(this.deck[i].card.types[j] === "instant")
                        {
                            typeArray[3].amount++;
                        }
                        else if(this.deck[i].card.types[j] === "land")
                        {
                            typeArray[4].amount++;
                        }
                        else if(this.deck[i].card.types[j] === "phenomenon")
                        {
                            typeArray[5].amount++;
                        }
                        else if(this.deck[i].card.types[j] === "plane")
                        {
                            typeArray[6].amount++;
                        }
                        else if(this.deck[i].card.types[j] === "planeswalker")
                        {
                            typeArray[7].amount++;
                        }
                        else if(this.deck[i].card.types[j] === "scheme")
                        {
                            typeArray[8].amount++;
                        }
                        else if(this.deck[i].card.types[j] === "sorcery")
                        {
                            typeArray[9].amount++;
                        }
                        else if(this.deck[i].card.types[j] === "tribal")
                        {
                            typeArray[10].amount++;
                        }
                        else if(this.deck[i].card.types[j] === "vanguard")
                        {
                            typeArray[11].amount++;
                        }
                        
                    }
                }   
                
                return typeArray;
            },
            
            getDeckCMC: function () {
                //return an array of the number of cards of each Converted Mana Cost in the deck
                console.log("CMC");
                var cmcArray = [];
                
                for(var i = 0; i <= 16; i++)
                {
                    cmcArray[i] = 0;
                }
                
                for(var i = 0; i < this.deck.length; i++)
                {
                    cmcArray[this.deck[i].card.cmc]++;
                }
                
                console.log(cmcArray);
                
                return cmcArray;
            },
            
            getDeckAverageCMC: function () {
                //get average Converted Mana Cost of cards in deck
                var average = 0;
                
                for(var i = 0; i < this.deck.length; i++)
                {
                    average += this.deck[i].card.cmc;
                }
                
                return average/this.deck.length;
            },
            
            storeDeck: function () {
                //put deck into local storage
                if(typeof(Storage) !== "undefined") 
                {
                    localStorage.setItem("deck", JSON.stringify(this.deck));
                }
                else
                {
                    console.log("This browser doesn't support Local Storage");
                }
            },
            
            retrieveDeck: function () {
                //retrieve deck from local storage
                if(typeof(Storage) !== "undefined") 
                {
                    this.deck = JSON.parse(localStorage.getItem("deck"));
                }
                else
                {
                    console.log("This browser doesn't support Local Storage");
                }
            }
            
        });
    </script>
</dom-module>
        